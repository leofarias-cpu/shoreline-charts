import { join, dirname } from 'path'
import { getReferences } from './props-utils.mjs'
import { kebabCase } from '@vtex/shoreline-utils'
import fse from 'fs-extra'
import { format } from 'prettier'

const outputDirectory = `${dirname('')}/__props__`
const outputFile = 'index.ts'

const files = [
  getPath('components', 'alert', 'alert'),
  getPath('components', 'bleed', 'bleed'),
  getPath('components', 'button', 'button'),
  getPath('components', 'center', 'center'),
]

let tsCode = `
// This file is autogenerated by scripts/build-props.mjs
// Do not edit this file directly.

export default {
`

async function main() {
  const refs = {}

  files.forEach((file) => {
    const ref = getReferences(file)[0]

    refs[kebabCase(ref.name)] = ref

    tsCode += `
      "${kebabCase(ref.name)}": ${JSON.stringify(ref)},
      `
  })

  tsCode += '}'

  const formattedTsCode = await format(tsCode, {
    parser: 'typescript',
    semi: false,
    singleQuote: true,
  })

  fse.outputFile(`${outputDirectory}/${outputFile}`, formattedTsCode, (err) => {
    if (err) {
      console.log(err)
    } else {
      console.log('âœ… Props documentation generated!')
    }
  })
}

function getPath(pkg, folder, file) {
  return join(dirname(''), `../${pkg}/src/${folder}/${file}.tsx`)
}

main()
