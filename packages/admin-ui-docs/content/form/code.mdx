import { Section } from '@site/src/components/Section'

<Section hasExplanation>

## Installation

The `admin-ui-form` package is not included in the `admin-ui` bundle, so you must add it.

```sh
# with yarn
yarn add @vtex/admin-ui-form

# with npm
npm install @vtex/admin-ui-form
```

</Section>

<Section>

## Usage

```jsx
import { Form, useFormState } from '@vtex/admin-ui-form'

function Example() {
  const form = useFormState()

  const handleSubmit = (data) => {
    // form data
  }

  return (
    <Form state={form} onSubmit={handleSubmit}>
      {/** ... components ... */}
      <Button type="submit">Submit</Button>
    </Form>
  )
}
```

</Section>

<Section hasExplanation>

## Key concepts

To understand how this library works you need first to understand some concepts.

</Section>

<Section hasExplanation>

### Name

This property specifies the name of the input, and it is used to subscribe to it. You can pass this prop to every component in this library.

</Section>

<Section hasExplanation>

### Subscriptions

The ability to watch individual inputs and formState updates without re-rendering the entire form. There are two ways of subscribing to an input element: using the `Watch` component or the `useWatch` hook. They can be used as a replacement for the `onChange` callback.

</Section>

<Section>

#### Watch

```jsx noInline live
const { Form, Watch, TextInput, useFormState } = Forms

function Example() {
  const form = useFormState()

  const handleSubmit = (data) => {
    alert(JSON.stringify(data))
  }

  return (
    <Form state={form} onSubmit={handleSubmit}>
      <Stack space="$2xl">
        <TextInput
          label="Name"
          name="input-name"
          helpText="Enter your name"
          state={form}
        />

        <Button type="submit">Submit</Button>
        <p>
          Name: <Watch form={form} name="input-name" />
        </p>
      </Stack>
    </Form>
  )
}

render(<Example />)
```

</Section>

<Section>

#### useWatch

```jsx noInline live
const { Form, useWatch, TextInput, useFormState } = Forms

function Example() {
  const form = useFormState()

  const handleSubmit = (data) => {
    alert(JSON.stringify(data))
  }

  const inputNameWatch = useWatch({
    form,
    name: 'input-name', // The value of the target's prop 'name': "input-name"
  })

  return (
    <Form state={form} onSubmit={handleSubmit}>
      <Stack space="$2xl">
        <TextInput
          label="Name"
          name="input-name"
          helpText="Enter your name"
          state={form}
        />

        <Button type="submit">Submit</Button>
        <p>Name: {inputNameWatch}</p>
      </Stack>
    </Form>
  )
}

render(<Example />)
```

</Section>

<Section hasExplanation>

### State hook

This hook is what makes it possible to subscribe to each form input and isolate the re-render at the hook level.
It has its scope in terms of subscriptions, so it does not affect other `useFormState`.

</Section>

<Section hasExplanation>

#### defaultValues

Use the state prop `defaultValues` to load form components with initial values. The keys of this object must have the same name you set for the component.

```jsx noInline live
const { Form, Watch, TextInput, NumberInput, useFormState } = Forms

function Example() {
  const form = useFormState({
    defaultValues: {
      inputName: 'Initial Name',
      inputAge: 18,
    },
  })

  const handleSubmit = (data) => {
    alert(JSON.stringify(data))
  }

  return (
    <Form state={form} onSubmit={handleSubmit}>
      <Stack space="$2xl">
        <TextInput
          label="Name"
          name="inputName"
          helpText="Enter your name"
          state={form}
        />

        <NumberInput
          label="Age"
          name="inputAge"
          helpText="Enter your age"
          state={form}
        />

        <Button type="submit">Submit</Button>
      </Stack>
    </Form>
  )
}

render(<Example />)
```

</Section>

<Section>

## Props

</Section>

<Section hasExplanation>

### Form

Extends all props of `<form>` JSX element.

| Name  | Type      | Description            | Required | Default |
| ----- | --------- | ---------------------- | -------- | ------- |
| state | FormState | Return of useFormState | âœ…       | -       |

</Section>

<Section hasExplanation>

### TextInput

Extends all props of the `TextInput` Admin UI element.

| Name       | Type              | Description              | Required | Default |
| ---------- | ----------------- | ------------------------ | -------- | ------- |
| state      | FormState         | Return of useFormState   | âœ…       | -       |
| name       | string            | Field name               | âœ…       | ''      |
| validation | ValidationOptions | Field validation options | ðŸš«       | -       |

</Section>

<Section hasExplanation>

### NumberInput

Extends all props of the `NumberInput` Admin UI element.

| Name       | Type              | Description              | Required | Default |
| ---------- | ----------------- | ------------------------ | -------- | ------- |
| state      | FormState         | Return of useFormState   | âœ…       | -       |
| name       | string            | Field name               | âœ…       | ''      |
| validation | ValidationOptions | Field validation options | ðŸš«       | -       |

</Section>

<Section hasExplanation>

### TextArea

Extends all props of `TextArea` JSX element.

| Name       | Type              | Description              | Required | Default |
| ---------- | ----------------- | ------------------------ | -------- | ------- |
| state      | FormState         | Return of useFormState   | âœ…       | -       |
| name       | string            | Field name               | âœ…       | ''      |
| validation | ValidationOptions | Field validation options | ðŸš«       | -       |

</Section>

<Section hasExplanation>

### Select

Extends all props of the `Select` Admin UI element.

| Name       | Type              | Description              | Required | Default |
| ---------- | ----------------- | ------------------------ | -------- | ------- |
| state      | FormState         | Return of useFormState   | âœ…       | -       |
| name       | string            | Field name               | âœ…       | ''      |
| validation | ValidationOptions | Field validation options | ðŸš«       | -       |

</Section>

<Section hasExplanation>

### Radio

Extends all props of the `Radio` Admin UI element.

</Section>

<Section hasExplanation>

### RadioGroup

Extends all props of the `RadioGroup` Admin UI element.

| Name       | Type              | Description              | Required | Default |
| ---------- | ----------------- | ------------------------ | -------- | ------- |
| state      | FormState         | Return of useFormState   | âœ…       | -       |
| name       | string            | Field name               | âœ…       | ''      |
| validation | ValidationOptions | Field validation options | ðŸš«       | -       |

</Section>

<Section hasExplanation>

### Checkbox

Extends all props of the `Checkbox` Admin UI element.

| Name       | Type              | Description              | Required | Default |
| ---------- | ----------------- | ------------------------ | -------- | ------- |
| state      | FormState         | Return of useFormState   | âœ…       | -       |
| name       | string            | Field name               | âœ…       | ''      |
| validation | ValidationOptions | Field validation options | ðŸš«       | -       |

</Section>

<Section hasExplanation>

### CheckboxGroup

Extends all props of the `CheckboxGroup` Admin UI element.

| Name       | Type              | Description              | Required | Default |
| ---------- | ----------------- | ------------------------ | -------- | ------- |
| state      | FormState         | Return of useFormState   | âœ…       | -       |
| name       | string            | Field name               | âœ…       | ''      |
| validation | ValidationOptions | Field validation options | ðŸš«       | -       |

</Section>

<Section hasExplanation>

### Switch

Extends all props of the `Switch` Admin UI element.

| Name  | Type      | Description            | Required | Default |
| ----- | --------- | ---------------------- | -------- | ------- |
| state | FormState | Return of useFormState | âœ…       | -       |

</Section>

<Section hasExplanation>

### useWatch

React Hook to subscribe to input changes. It returns the input value state.

| Name | Type      | Description            | Required | Default |
| ---- | --------- | ---------------------- | -------- | ------- |
| form | FormState | Return of useFormState | âœ…       | -       |
| name | string    | Field name             | âœ…       | -       |

</Section>

<Section hasExplanation>

### Watch

React Component to subscribe to input changes. It renders the input value state.

| Name | Type      | Description            | Required | Default |
| ---- | --------- | ---------------------- | -------- | ------- |
| form | FormState | Return of useFormState | âœ…       | -       |
| name | string    | Field name             | âœ…       | -       |

</Section>

<Section>

## Shared types

</Section>

<Section hasExplanation>

### FormState

All values returned by the `useFormState` hook.

| Name        | Type                                                                                 | Description                                                                                                                                                                                       |
| ----------- | ------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| register    | `(name: string, validation: ValidationOptions) => ({ onChange, onBlur, name, ref })` | Allows you to register and subscribe an input element                                                                                                                                             |
| formState   | `Object`                                                                             | This object contains information about the entire form state. It helps you to keep on track with the user's interaction with your form application.                                               |
| watch       | `(names?: string, string[], (value, options) => void) => unknown`                    | This method will watch specified inputs and return their values. It is useful to render input value and for determining what to render by condition.                                              |
| resetField  | `(name: string, options?: Record<string, boolean, any>) => void`                     | Reset an individual field state.                                                                                                                                                                  |
| setError    | `(name: string, error: FieldError, { shouldFocus?: boolean }) => void`               | The function allows you to manually set one or more errors.                                                                                                                                       |
| clearErrors | `(name?: string, string[]) => void`                                                  | This function can manually clear errors in the form.                                                                                                                                              |
| setValue    | `(name: string, value: unknown) => void`                                             | This function allows you to dynamically set the value of a registered field and have the options to validate and update the form state. At the same time, it tries to avoid unnecessary rerender. |
| getValues   | `(payload?: string, string[]) => Object`                                             | An optimized helper for reading form values. The difference between watch and getValues is that getValues will not trigger re-renders or subscribe to input changes.                              |

</Section>

<Section hasExplanation>

### ValidationOptions

Validation rules are all based on the HTML standard and also allow for custom validation methods.

| Name             | Type               | Description                                                                                                                                                                                                                                                   |
| ---------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| required         | `boolean`          | Indicates whether the input must have a value before the form can be submitted or not                                                                                                                                                                         |
| maxLength        | `number`           | The maximum length of the value to accept for this input                                                                                                                                                                                                      |
| minLength        | `number`           | The minimum length of the value to accept for this input                                                                                                                                                                                                      |
| max              | `number`           | The maximum value to accept for this input                                                                                                                                                                                                                    |
| min              | `number`           | The minimum value to accept for this input                                                                                                                                                                                                                    |
| pattern          | `RegExp`           | The regex pattern for the input                                                                                                                                                                                                                               |
| validate         | `Function, Object` | You can pass a callback function as the argument to validate, or you can pass an object of callback functions to validate all of them. This function will be executed on its own without depending on other validation rules including the required attribute |
| valueAsNumber    | `boolean`          | Returns a Number normally. If something goes wrong NaN will be returned.                                                                                                                                                                                      |
| valueAsDate      | `boolean`          | Returns a Date object normally. If something goes wrong Invalid Date will be returned                                                                                                                                                                         |
| disabled         | `boolean = false`  | Set disabled to true will lead input value to be undefined and input control to be disabled                                                                                                                                                                   |
| onChange         | `(event) => void`  | onChange function event to be invoked in the change event                                                                                                                                                                                                     |
| onBlur           | `(event) => void`  | onBlur function event to be invoked in the blur event                                                                                                                                                                                                         |
| shouldUnregister | `boolean`          | Input will be unregistered after unmount and defaultValues will be removed as well                                                                                                                                                                            |
| deps             | `string, string[]` | Validation will be triggered for the dependent inputs                                                                                                                                                                                                         |

</Section>
